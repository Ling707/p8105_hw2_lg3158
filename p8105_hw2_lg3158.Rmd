---
title: "p8105_hw2_lg3158"
author: "Ling"
date: "10/4/2021"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
```

# Problem 1

Read the sheet:
```{r Q1 read the Mr.Trash Wheel sheet}

library(readxl)
Q1 = read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
                sheet = "Mr. Trash Wheel",
                range = cell_cols("A:N"),
                trim_ws = T,
                skip = 1,
                col_names = T,
                col_types = c("numeric","guess","numeric","guess","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric"),
                .name_repair = "universal") %>%
  janitor::clean_names() %>%
  mutate( sports_balls = round(sports_balls, digits = 0)) %>%
  filter( !is.na(dumpster))
```

The Q1 dataset now satisfies the criteria below:

  - read from the excel 'Mr. Trash Wheel' sheet;
  - omitted non-data entries;
  - cleaned variable names;
  - omitted rows with `NA` values in variable dumpster;
  - round the values of sports_balls to the nearest integers
  
Now read and clean precipitation data for 2018 and 2019.

```{r Q1 read precipitation data}
pre2018 <- read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
                      range = "2018 Precipitation!A2:B14",
                      col_names = T,
                      col_types = c("guess","numeric"),
                      skip = 1,
                      .name_repair = "universal") %>%
  janitor::clean_names() %>%
  drop_na(total) %>%
  mutate(year = 2018) %>%
  relocate(year)

pre2019 <- read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
                      range = "2019 Precipitation!A2:B14",
                      col_names = T,
                      col_types = c("guess","numeric"),
                      skip = 1) %>%
  janitor::clean_names() %>%
  drop_na(total) %>%
  mutate(year = 2019)

precipitation = bind_rows(pre2018, pre2019) %>%
  mutate(month = month.name[month]) %>%
  rename(precipitation_in = total)
  

Q1_final = left_join(Q1, precipitation, by = c("year","month"))

```

The dataset Q1_final contains data from Mr. Trash Wheel sheet and the precipitation data of 2018 and 2019. The brief summary of the data is below:
`r library(skimr)`
`r skimr::skim(Q1_final)`
For available data, the total precipitation in 2018 is `r sum(pull(pre2018,total))` inches. The median number of sports balls in a dumpster in 2019 was `r median(pull(subset(Q1_final, year == "2019"),sports_balls))`.

# Problem 2

Clean the data in pols-month.csv.
```{r}
pols_month = read_csv("./data/fivethirtyeight_datasets/pols-month.csv") %>%
  separate(mon, into = c("year","month","day"), convert = T) %>%
  mutate(month = month.name[month]) %>%
  mutate(president = if_else(prez_gop == 1, "gop", "dem")) %>%
  select(-c("prez_gop","prez_dem","day"))
```

Clean the data in snp.csv.
```{r}
snp = read_csv("./data/fivethirtyeight_datasets/snp.csv") %>%
  mutate(date = lubridate::mdy(date)) %>%
  separate(date, into = c("year","month" ,NA), convert = T) %>%
  arrange(year, month) %>%
  mutate(month = month.name[month])
```

Clean the data in unemployment.csv.
```{r}
unem = read_csv("./data/fivethirtyeight_datasets/unemployment.csv") %>%
  rename(mon_1 = Jan,
         mon_2 = Feb,
         mon_3 = Mar,
         mon_4 = Apr,
         mon_5 = May,
         mon_6 = Jun,
         mon_7 = Jul,
         mon_8 = Aug,
         mon_9 = Sep,
         mon_10 = Oct,
         mon_11 = Nov,
         mon_12 = Dec,
         year = Year) %>%
  pivot_longer(
    cols = mon_1:mon_12,
    names_to = "month",
    values_to = "unemp_rate",
    names_prefix = "mon_"
  ) %>%
  mutate(month = month.name[as.numeric(month)])
```

Now merge the 3 datasets: snp into pols, then unemployment into the merged.

```{r}
merge_1 = left_join(pols_month,snp, by = c("year","month"))

merge_2 = left_join(merge_1, unem, by = c("year","month"))
```




